# Red Alert — контекст изменений (2026-02-08)

## Исходное состояние
PWA трекер цикла (vanilla JS, IndexedDB). Основные файлы:
- app.js — логика UI
- calc.js — расчёты (прогноз, фертильность)
- db.js — IndexedDB

## Что исправили

### 1) Редактирование даты начала цикла ломало календарь
Причина: при редактировании startDate не обновлялся `predictedEndDate`, также не было проверки пересечений циклов.
Исправление в `app.js` (модалка редактирования цикла):
- пересчёт `prediction` при сохранении
- обновление `predictedEndDate`
- проверка пересечений диапазонов и дубликата `startDate`
Файл: `app.js`

### 2) Овуляция считалась на 1 день позже
Причина: формула использовала `startDate + (cycleLength - 14)` дней, что даёт 15‑й день при 28‑дневном цикле.
Исправление в `calc.js`:
- `ovulationDate = startDate + (cycleLength - 15)` дней
- комментарий: день 1 = startDate, овуляция ≈ за 14 дней до следующей менструации
Файл: `calc.js`

### 3) Настройки длины цикла/месячных не пересчитывали прогноз
Причина: при изменении ползунков менялись defaults, но не вызывался refresh UI/прогнозов.
Исправление в `app.js`:
- добавить `App.refresh()` на `input` обоих слайдеров
Файл: `app.js`

## Примечания
- При деплое на GitHub Pages Service Worker кэширует версию — при изменениях нужен hard reload и/или `Unregister` SW.
- При редактировании циклов пересечения теперь блокируются уведомлением.

## Текущие файлы, которые изменялись
- `app.js`
- `calc.js`

## Что сделали по репозиторию (2026-02-08)
- Добавили контекстный файл: `docs/2026-02-08-context.md`.
- Создали GitHub репозиторий и запушили код: https://github.com/dovgulya/Red-Alert
- Коммит: `69dcbcb` (Add change context notes).
- Настроен `origin` и включён push на ветку `main`.

## Дальнейшие шаги (PWA)
- Включить GitHub Pages: Settings → Pages → Source: Deploy from a branch → `main` + `/ (root)`.
- После публикации появится URL вида `https://dovgulya.github.io/Red-Alert/`.
